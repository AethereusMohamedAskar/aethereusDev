<table cellpadding="0" cellspacing="0" width="100%" role="presentation" style="min-width: 100%; " class="stylingblock-content-wrapper"><tr><td class="stylingblock-content-wrapper camarker-inner">%%[ set @contactId = RequestParameter("contactId") set @marketing = Iif(RequestParameter("marketingpromotions") == "on", "true", "false") set @business = Iif(RequestParameter("businessupdates") == "on", "true", "false") set @unsuball = Iif(RequestParameter("emailoptout") == "on", "true", "false") IF @unsuball == true THEN /*update contact in Marketing Cloud */ SET @updateData = UpsertData("Homans_DE_All_Contacts",1, "Id", @contactId, "Marketing_Promotions",@marketing, "Business_Updates",@business, "Email_Opt_Out",@unsuball ); /*update contact in Sales Cloud */ SET @updateRecord = UpdateSingleSalesforceObject("Contact",@contactId, "Marketing_Promotions__c",@marketing, "Business_Updates__c",@business, "HasOptedOutOfEmail",@unsuball ); /* log unsubscribe event to mark as unsubscribed in All Subscribers */ SET @reason = "Unsub-Custom Landing Page" SET @lue = CreateObject("ExecuteRequest") SETObjectProperty(@lue,"Name","LogUnsubEvent") SET @lue_prop = CreateObject("APIProperty") SETObjectProperty(@lue_prop, "Name", "SubscriberKey") SETObjectProperty(@lue_prop, "Value", @contactId) AddObjectArrayItem(@lue, "Parameters", @lue_prop) SET @lue_prop = CreateObject("APIProperty") SETObjectProperty(@lue_prop, "Name", "Reason") SETObjectProperty(@lue_prop, "Value", @reason) AddObjectArrayItem(@lue, "Parameters", @lue_prop) SET @lue_statusCode = InvokeExecute(@lue, @overallStatus, @requestId) Redirect("https://mcfyfwscx0zgzfvrhzpbd0vv9kj1.pub.sfmc-content.com/yxjv3i4qmj0") ELSEIF @unsuball != true THEN /*update contact in Marketing Cloud */ SET @updateData = UpsertData("Homans_DE_All_Contacts",1, "Id", @contactId, "Marketing_Promotions",@marketing, "Business_Updates",@business, "Email_Opt_Out",@unsuball ); /*update contact in Sales Cloud */ SET @updateRecord = UpdateSingleSalesforceObject("Contact",@contactId, "Marketing_Promotions__c",@marketing, "Business_Updates__c",@business, "HasOptedOutOfEmail",@unsuball ); /* set subscriber status to active in All Subscribers */ SET @Subscriber = CreateObject("Subscriber") SetObjectProperty(@Subscriber, "SubscriberKey", @contactId) SetObjectProperty(@Subscriber, "Status", "Active" ) SET @Status = InvokeUpdate(@Subscriber, @createErrDesc, @createErrNo, @createOpts) Redirect("https://mcfyfwscx0zgzfvrhzpbd0vv9kj1.pub.sfmc-content.com/yxjv3i4qmj0") ENDIF ]%%</td></tr></table>